<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MCDONALD'S EDSA CALOOCAN | ePlanner</title>
<link rel="icon" type="image/png" href="mdco.png">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root { --bg-image: url("mcdo_cover.png"); }
body { 
    font-family:'Roboto',sans-serif; 
    margin:0; 
    min-height:100vh; 
    background: linear-gradient(rgba(0,0,0,0.55), rgba(0,0,0,0.55)), var(--bg-image) no-repeat center / cover; 
    display:flex; 
    flex-direction:column; 
    color:#333;
}
.top-header { 
    display:flex;justify-content:space-between;align-items:center;
    padding:18px 30px;background: rgba(0,0,0,0.65);backdrop-filter:blur(6px);
    color:#fff;box-shadow:0 4px 12px rgba(0,0,0,0.35);
}
.header-left { font-size:1.3rem;font-weight:700;}
.home-btn { text-decoration:none;background:#f2c94c;color:#333;padding:8px 18px;border-radius:20px;font-weight:700;}
.home-btn:hover { background:#e0b842;}
main { flex:1; display:flex;justify-content:center;align-items:flex-start; padding:25px; }
.calendar-container { width:100%; max-width:1200px; background: rgba(255,255,255,0.95); padding:25px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,0.25); overflow-x:auto;}
#calendar-controls { display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:10px;}
#calendar-controls button { background:#f2c94c;border:none;padding:10px 18px;border-radius:10px;font-weight:700;cursor:pointer;flex:1 1 100px;}
#monthYear { font-size:1.6rem;color:#c62828;font-weight:700;flex:1 1 auto;text-align:center;}
#calendar { display:grid;grid-template-columns:repeat(7,1fr);gap:12px;}
.day-header { text-align:center;font-weight:700;padding:10px 0;background:#c62828;color:#fff;border-radius:8px;font-size:0.9rem;}
.day { background:#fff;border-radius:12px;padding:10px;min-height:135px;box-shadow:0 4px 10px rgba(0,0,0,0.1);position:relative;display:flex;flex-direction:column;}
.today { border:2px solid #c62828;background:#fff8e1;}
.available { background:#e8f5e9;color:#2e7d32;font-size:0.75rem;padding:6px;border-radius:6px;margin-top:6px;font-weight:600;}
.pencil { background: orange;color: #fff;font-size:0.75rem;padding:6px;border-radius:6px;margin-top:6px;font-weight:700;}
.confirmed { background: #2196F3;color:#fff;font-size:0.75rem;padding:6px;border-radius:6px;margin-top:6px;font-weight:700;}
.past { background:#f1f1f1;color:#999;box-shadow:none;}
.past::after { content:"PAST";position:absolute;top:8px;right:10px;font-size:0.6rem;background:#bdbdbd;color:#fff;padding:2px 6px;border-radius:6px;font-weight:700;}
.past .available, .past .pencil, .past .confirmed { background:#e0e0e0;color:#9e9e9e;}
@media(max-width:992px){ main{padding:15px;} #calendar-controls button{flex:1 1 45%;} }
</style>
</head>
<body>

<header class="top-header">
<div class="header-left">üçî MCDONALD'S EDSA CALOOCAN - ePlanner</div>
<a href="https://sites.google.com/view/mcdoedsacaloocan?usp=sharing" class="home-btn">Home</a>
</header>

<main>
<div class="calendar-container">
<div id="calendar-controls">
<button id="prevMonth">Prev</button>
<h2 id="monthYear"></h2>
<button id="nextMonth">Next</button>
</div>
<div id="calendar"></div>
</div>
</main>

<script>
let currentDate = new Date();

const partySlots = [
    {key:"06:00", display:"6:00‚Äì7:30 AM"},
    {key:"09:00", display:"9:00‚Äì10:30 AM"},
    {key:"14:00", display:"2:00‚Äì3:30 PM"},
    {key:"17:00", display:"5:00‚Äì6:30 PM"},
    {key:"20:00", display:"8:00‚Äì9:30 PM"}
];

function loadEvents(){
    let ev=JSON.parse(localStorage.getItem('mcdonaldsEvents')||'{}');
    const today=new Date(); today.setHours(0,0,0,0);
    Object.keys(ev).forEach(d=>{
        Object.keys(ev[d]).forEach(slot=>{
            let e=ev[d][slot];
            if(e.status=='Pencil Booking'){
                let pencilDate=new Date(d); pencilDate.setDate(pencilDate.getDate()+7);
                if(today>pencilDate) delete ev[d][slot];
            }
        });
        if(Object.keys(ev[d]).length===0) delete ev[d];
    });
    return ev;
}

function timeToMinutes(t){ const [h,m]=t.split(':'); return parseInt(h)*60+parseInt(m); }

function getAvailablePartySlots(date){
    const events = loadEvents();
    const dayEvents = events[date]||{};
    return partySlots.filter(slot=>{
        for(let s in dayEvents){
            const e = dayEvents[s];
            if(e.type!=='Party'){
                const [eStart,eEnd]=s.split('-');
                const [slotStart,slotEnd]=getPartySlotEnd(slot.key); 
                if(!(timeToMinutes(slotEnd)<=timeToMinutes(eStart) || timeToMinutes(slotStart)>=timeToMinutes(eEnd))) return false;
            } else { if(s==slot.key) return false; }
        }
        return true;
    });
}

function getPartySlotEnd(start){ 
    const [h,m]=start.split(':'); 
    let sh=parseInt(h), sm=parseInt(m); 
    sh+=1; sm+=30; 
    if(sm>=60){ sh+=1; sm-=60; }
    const end = `${String(sh).padStart(2,'0')}:${String(sm).padStart(2,'0')}`;
    return [start,end];
}

function renderCalendar(){
    const year=currentDate.getFullYear(), month=currentDate.getMonth();
    const daysInMonth=new Date(year,month+1,0).getDate();
    const firstDay=new Date(year,month,1).getDay();
    const today=new Date(); today.setHours(0,0,0,0);
    const calendar=document.getElementById('calendar'); calendar.innerHTML='';
    document.getElementById('monthYear').textContent=`${currentDate.toLocaleString('default',{month:'long'})} ${year}`;

    ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach(d=>{ const h=document.createElement('div'); h.className='day-header'; h.textContent=d; calendar.appendChild(h); });
    for(let i=0;i<firstDay;i++){ const empty=document.createElement('div'); empty.className='day'; calendar.appendChild(empty); }

    const events=loadEvents();

    for(let day=1;day<=daysInMonth;day++){
        const dayDiv=document.createElement('div'); dayDiv.className='day';
        const dateObj=new Date(year,month,day); dateObj.setHours(0,0,0,0);
        if(dateObj<today) dayDiv.classList.add('past');
        if(dateObj.getTime()===today.getTime()) dayDiv.classList.add('today');
        dayDiv.innerHTML=`<strong>${day}</strong>`;
        const dateKey=`${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
        const dayEvents=events[dateKey]||{};

        const availableParty = getAvailablePartySlots(dateKey);
        availableParty.forEach(slot=>{
            const slotDiv=document.createElement('div'); slotDiv.className='available';
            slotDiv.textContent=`${slot.display} - Available`;
            dayDiv.appendChild(slotDiv);
        });

        Object.keys(dayEvents).forEach(s=>{
            const e=dayEvents[s];
            const slotDiv=document.createElement('div'); 
            slotDiv.className=e.status==='Pencil Booking'?'pencil':'confirmed';
            slotDiv.textContent=`${formatAMPM(s)} - ${e.type} (${e.status})`;
            dayDiv.appendChild(slotDiv);
        });

        calendar.appendChild(dayDiv);
    }
}

function formatAMPM(slot){
    let start,end;
    if(slot.includes('-')) [start,end]=slot.split('-');
    else { start=slot; end=parseInt(start.split(':')[0])+1+':'+start.split(':')[1]; }
    return toAMPM(start)+'‚Äì'+toAMPM(end);
}

function toAMPM(time){
    let [h,m]=time.split(':'); h=parseInt(h); let ampm=h>=12?'PM':'AM'; h=h%12||12; return h+':'+m+' '+ampm;
}

renderCalendar();
document.getElementById('prevMonth').addEventListener('click',()=>{currentDate.setMonth(currentDate.getMonth()-1); renderCalendar();});
document.getElementById('nextMonth').addEventListener('click',()=>{currentDate.setMonth(currentDate.getMonth()+1); renderCalendar();});
</script>

</body>
</html>
